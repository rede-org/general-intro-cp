# 4.3  Working with Buckets

## Collection-Focused Behaviors

Some behaviors will need to operate for every instance of a type of context. The [logging behavior](4.2-from-when-to-whenever.md#logging) created in the last chapter is an example of such a behavior. Up to this point, its declaration looks like:

```
Perform Logging ::
    logging per Log Settings for Log Message: {settings, message}
        when message(Level) >= settings(Minimum Level)?
    {
        Log :: for {message} when initialized?
            evaluate "Log: \(message)" as Console Message,
            \deactivate message;
    }.
```

As it is currently implemented, there will be an instance of this behavior for every `Log Message` (assuming there is only one `Log Settings` in the application). That instance will be destroyed after its initialization operation executes. There isn't anything wrong with this implementation, but it does require a bit more work by the application to continually cycle through new instances of the behavior. It also required the `Log Settings` to be maintained by another behavior so it would persist across the destruction of this behavior's instances.

These requirements can be removed by making `Perform Logging` focused on the application's collection of `Log Message` rather than each instance. Doing so can result in the behavior looking like:

```
Perform Logging ::
    logging per Log Settings for {*Log Message*}: {settings, messages}
    {
        Evaluate Messages :: for {settings, messages} 
            whenever |messages| > 0, 
            foreach message in messages?
                evaluate message for settings,
                \deactivate message;
        
        Log :: message for {settings}
            when message(Level) >= settings(Minimum Level)?
                evaluate "Log: \(message)" as Console Message;
    }.
```

The first change to point out is `{*Log Message*}` replacing `Log Message` in the behavior description. This change is what makes the behavior collection-focused. Surrounding a context type with curly braces and stars, generally as `{* "Context Type" *}`, defines what is called a "bucket" of those contexts. A bucket is... \[describe a bucket].



\[Describe the changes to the behavior, including: the bucket, the size retrieval, and the composition-based evaluate.]







## Managing the Collection(s)

\[Detail how a behavior's buckets can be mapped, filtered, and sorted.]

\[Update logging to filter the messages of the behavior instead of for the operation.]
