# 3.2  Expanding on 'When'

## Operation Conditions

In the[ Hello World example](3.1-hello-world.md), `when initialized` was introduced as a Circumstantial Control Flow qualification. However, `when` can specify many other qualifications. Most often these qualifications will be conditions that the contexts of an operation must meet for the operation to be performed.

A simple example can be one that checks whether an input number is even. As before, it's best to [define the context](../chapter-2-creating-context/2.1-organizing-data.md#defining-a-context) that we will use first:

```
Input Number: context Int.
```

Then the entry point to the application, where the user will be asked to provide a number:

```
Even Checker: when initialized?
    await "Please enter a number." as Console Message,
    await response: Console Response;
    await response to Input Number.
```

{% hint style="warning" %}
Notice how `response` is being mapped to an `Input Number` using the `to` keyword. `response` is a `Console Response` which is an alias for a `String` which, in Rede, has a built-in mapping to an `Int` which `Input Number` is an alias for. The full steps of what is occurring here are: `response` being checked for a direct mapping to `Input Number`, when this isn't found `response` is checked for a direct mapping to `Int`, when this isn't found `response` is de-aliased as a `String` which is checked for a mapping to `Input Number`, when this isn't found `response` (as a `String`) is checked for a mapping to an `Int`, which is found. The mapping is then attempted and the `Int` is aliased back to an `Input Number`.&#x20;

This mapping will attempt to map the `String` to an `Int` in any way that it can, and if it can't, then an error will be thrown. There are ways to check that a `String` and can be safely mapped to an `Int`, a couple of which are covered in later sections.
{% endhint %}

This initial operation requests a number from the user, then waits for the response, and then awaits any operations that handle the response as an `Input Number`. Here is an operation to do just that:

```
Notify Of An Even Input Number: <number> when number % 2 = 0?
    await "That number is even!" as Console Message.
```

This operation will be performed for an awaited `Input Number` which it will call `number`. `number` must be even (modulus[^1] 2, leaving no remainder) for the operation to be performed, as specified by `when number % 2 = 0`. Upon being performed, the operation sends a console message that the number is even.

It may be nice to also notify the user of when the number is not even, which can be done with this similarly looking operation:

```
Notify Of A Not Even Input Number: <number> when number % 2 = 1?
    await "That number is not even!" as Console Message.
```



## Operations with Multiple Contexts

\[Detail how Console Response can be aliased as an Unvalidated Int String, with a Validated Int String, which can then be safely converted to Input Number for other use. If Validate Int String (Is Valid Int) is false, then a different message can be provided.]

The initial implementation of the Even Checker doesn't validate whether the user actually provided a number. As is, it would crash for non-numerical input, which is usually not a desired result. The implementation can be updated to use aliases that will make use of Rede's built-in validation operations.

```
Even Checker: when initialized?
    await "Please enter a number." as Console Message,
    await response: Console Response;
    await <response as Unvalidated Int String, 
        validated response: Validated Int String;>,
    await validated response.
```

The initial operation has a new line `await <response as Unvalidated Int String, validated response: Validated Int String;>,` that aliases the response (an already aliased `String`) as an `Unvalidated Int String` (a built-in alias of `String`) and declares a new `validated response` which is another built-in context, `Validated Int String`. Awaiting these two contexts together will initiate an operation that validates the text of the `Unvalidated Int String` and updates the `Validated Int String` with the result.

`Validated Int String` is a context with two properties, `Is Valid Int`, which is a `Bool` (true or false), and `Value` which is the `String` that has been validated. If the `Value` can safely be converted to an `Int` then `Is Valid Int` is `True`. Knowing that, a new operation can be made to be performed from the initial operation's `await validated response`:

```
Initiate Validated Int String Check: <input> when input (Is Valid Int)?
    await input (Value) to Input Number.
```

The above operation will map the user's input `String` to the `Input Number` context and await that, which will initiate either `Notify Of An Even Input Number` or `Notify Of A Not Even Input Number` operation.

One benefit to this method of input validation is the ability to handle the invalid case, such as with this operation:

```
Notify User Of Bad Input For Validated Int String: <input> 
    when not input (Is Valid Int)?
        await "That is not a number." as Console Message.
```



## Conditional Value Declarations

\[Detail how values can be declared within Operation qualifications, and that the ability to declare them acts as a qualification itself.]



## Identifiers and Execution Order

\[Detail identifiers and how operations can coordinate among each other with execution order.]

[^1]: Modulus is represented by `%` in Rede, as it is in many other languages as well.
